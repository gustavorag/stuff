https://fusemail.atlassian.net/wiki/spaces/~697372191/pages/466747471/Stories+for+new+usage

 https://fusemail.atlassian.net/browse/EMBT-1400


https://fusemail.atlassian.net/browse/EMD-1707

 Takeaways

     Rollback junk metadata (Job, File, etc) if you can't even save an error audit trail.
     Static tables are de facto documentation because we can't ask people to read Confluence or readme. Doesn't control logic.
     Can't do build tags because FM CI doesn't support multiple Bamboo jobs per Bitbucket. Do generic.NewLib(zix.NewReader()).Run() instead.
     If you run a downloader service, always create a Job.
     If the downloader service downloads a file, always save it to filesystem. Try to save File metadata.
     If a downloader downloads a duplicate file, the translator/importer will ignore it, and the archiver will eventually archive it.
     Services run in CLI mode for emergency fallback. Saves username etc in audit trail.
     Phase 2 will have reporting on Phase 1 data.
     Phase 3 will use reporting to push into billing system.
     Duplicate file only ignored if it's CONSECUTIVE. Don't ignore if tomorrow == yesterday <> today. Applies to all frequency like monthly.
     We want immutable audit trail, but we're keeping modified_by etc fields in the database because FM always has them.

 Job

     Multiple Jobs per day. Arbitrary consecutive freqeuncy.
     Include current step
     Include current step status
     Current step and current step status don't control application logic. They're just duplicated values because we can't ask people to join Job with Step.
     Rename Job.id to Job.job_id

 File

     Bigint primary key instead of checksum.
     Checksum needs unique on (id) constraint.
     Include full file path even if it's just a Docker volume mount point.
     Rename File.id to File.file_id

 Step

     File is a bigint foreign key. Defaults to 0 apparently because FM doesn't like null and also doesn't want to normalize.
     No checksum here.
     No type enum. StepType ID instead.
     Add field for last error. Default empty string.
     Rename Step.id to Step.step_id

 StepError

     Merge into Step error field

 StepType

     Static table
     Include order i32 field. Document order for Step in Job for Source
     Include StepType.step_type_id
     Include StepType.source_id


     2.30
     593.71
     31.34
     8.98

     Grocery  11.28
     Clothes  31.34
             593.71
             636.33


             git clone git@bitbucket.org:fusemail/fm-lib-msgfetcher.git

git clone git@bitbucket.org:fusemail/legacy-service-vaultsmart-fetcher-auditor.git
