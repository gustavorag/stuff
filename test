DELIMITER //
CREATE FUNCTION checkDuplicateZix(
  p_senderAddress VARCHAR(255),
  p_recipientAddress VARCHAR(255),
  p_sentTimeStamp TIMESTAMP,
  p_jobId BIGINT
)
RETURNS TINYINT(1)
BEGIN
  DECLARE s BOOLEAN;
  IF 1 = 1 THEN RETURN SET s = 1;
  ELSE SET s = 0;
  END IF;
  RETURN s;
END //

DELIMITER ;


 EXISTS (
    select * from zix_usage
    WHERE
    sender_address = p_senderAddress AND
    recipient_address = p_recipientAddress AND
    sent_time_stamp = p_sentTimeStamp AND
    job_id <> p_jobId
  )

select from checkDuplicateZix('sender1@senderdoman.com', 'receiver2@receiverdoman.com', STR_TO_DATE('2018-04-01 10:05:20','%Y-%m-%d %H:%i:%s'), 1);

DELIMITER $$
DROP FUNCTION IF EXISTS checkDuplicateZix;
CREATE FUNCTION checkDuplicateZix(p_senderAddress VARCHAR(255),
  p_recipientAddress VARCHAR(255),
  p_sentTimeStamp TIMESTAMP,
  p_jobId BIGINT
) RETURNS TINYINT(1)
    DETERMINISTIC
BEGIN
    DECLARE s TINYINT(1);

    IF EXISTS (
       select * from zix_usage
       WHERE
       sender_address = p_senderAddress AND
       recipient_address = p_recipientAddress AND
       sent_time_stamp = p_sentTimeStamp AND
       job_id <> p_jobId
     )  THEN SET s = 1;
    ELSE SET s = 0;
    END IF;
 RETURN (s);
END $$;

FOR EACH ROW
       BEGIN
           IF NEW.amount < 0 THEN
               SET NEW.amount = 0;
           ELSEIF NEW.amount > 100 THEN
               SET NEW.amount = 100;
           END IF;
       END;//

DELIMITER $$


DROP TRIGGER IF EXISTS trigger_ck_insert_zix;
CREATE TRIGGER trigger_ck_insert_zix BEFORE INSERT ON zix_usage
FOR EACH ROW
BEGIN
  IF EXISTS (
     select * from zix_usage
     WHERE
     sender_address = new.sender_address AND
     recipient_address = new.recipient_address AND
     sent_time_stamp = new.sent_time_stamp AND
     job_id <> new.job_id
   )  THEN signal sqlstate '45000';
  END IF;
END $$;

create index sendadd_index ON zix_usage (sender_address(255));
create index recadd_index ON zix_usage (recipient_address(255));
create index senttime_index ON zix_usage (sent_time_stamp);
create index jobid_zix_index ON zix_usage (job_id);

  drop index sendadd_index ON zix_usage;
  drop index recadd_index ON zix_usage (recipient_address(255));
  drop index senttime_index ON zix_usage;
  drop index jobid_zix_index ON zix_usage;


CREATE FUNCTION hello (s CHAR(20))
RETURNS CHAR(50) DETERMINISTIC
RETURN CONCAT('Hello, ',s,'!');
